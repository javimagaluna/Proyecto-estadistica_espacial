---
title: |
  <div style="text-align: center">
  ![](Logu.png){width=1in}  
  Delitos y densidad poblacional
  <div/>
author: |
  - Paula Muñoz Parada
  - Javiera Preuss Araya

output:
  rmdformats::material:
    highlight: kate
    df_print: kable
thumbnails: FALSE
    
---

```{r setup, warning=FALSE, include=FALSE}
library(knitr)
library(rmdformats)
library(here)

```

# Resumen

Mediante la exploración y visualización de datos, se evidenció ....

# Introducción


Todo delito trae consigo una serie de inconvenientes o sufrimiento para una o más personas. Por esto y más siempre ha sido de interés para el humano el estudio de diversos delitos. Lo ideal sería poder predecir estos actos para así evitar los daños generados, pero lamentablemente esto no es posible debido a la gran aleatoriedad de los actos de las personas. Aunque no se puede tener certeza de que se cometerá un delito, sí se puede tratar de encontrar un patrón espacial.

Es por esto que buscamos analizar los distintos niveles de delitos por comuna de la Región Metropolitana y relacionarlos con distintas variables comunales, como son el porcentanje de hacinamiento, la cantidad de habitantes por vivienda, el índice de masculinidad poblacional, nivel de escolaridad del jefe de hogar, entre otras. Queremos responder preguntas como ¿Existirán patrones identificables de los tipos de delitos según las diversas variables comunales? ¿Hay relación entre algunos delitos y el nivel de de hacinamiento? ¿Tiene incidencia el nivel educacional del jefe de hogar? ¿Qué delitos sí y cuáles no?

Además, dado que tenemos información espacial ¿Podremos predecir futuros lugares conflictivos según la evidencia de evolución temporal? o ¿Existirán relaciones en los resultados alcanzados entre las unidades vecinales (comunas)?

Las conclusiones obtenidas podrían usarse para que cada comuna genere medidas preventivas desde su realidad, al tomar conocimiento de las variables que propician estos delitos.

# Metodología

En este estudio utilizaremos los datos del Centro de Estudios y Análisis del Delito [CEAD](http://cead.spd.gov.cl/estadisticas-delictuales/#descargarExcel) para los delitos clasificados como: Consumo de alcohol en la vía pública, ruidos molestos, abusos sexuales y otros delitos sexuales, violencia intrafamiliar contra el adulto mayor, contra la mujer y contra el niño. También, usaremos datos del  [CENSO 2017](http://resultados.censo2017.cl/Region?R=R13) provenientes de INE. 

En las siguientes tablas podremos ver la descripción de nuestras variables a estudiar: 

Table: Tabla I: Descripción de variables Delitos en la región metropolitana.

| Variable | Tipo de variable | Descripción |
|---|---|---|
| COMUNA | Categórica | Nombre de la comuna |
| ALCOHOL | Numérica | Cantidad de denuncias por delitos de consumo de alcohol en la vía pública|
| RUIDO | Numérica | Cantidad de denuncias por delitos de ruidos molestos | 
| ABUSO | Numérica | Cantidad de denuncias por abusos sexuales y otros delitos sexuales | 
| VIO.ADULT | Numérica | Cantidad de denuncias por delitos de violencia intrafamiliar a adulto mayor| 
| VIO.MUJ | Numérica | Cantidad de denuncias por delitos de violencia intrafamiliar a mujer | 
| VIO.NIN | Numérica | Cantidad de denuncias por delitos de violencia intrafamiliar a niño/a | 
| ANIO | Numérica | Año de las denuncias (2010 al 2017)| 


Table: Tabla II: Descripción de variables CENSO 2017 RM.

| Variable | Tipo de variable | Descripción |
|---|---|---|
| Comuna | Categórica | Nombre de la comuna |
| POB | Numérica | Número de habitantes |
| VIV | Numérica | Número de viviendas | 
| HACI | Numérica | Porcentaje de viviendas con hacinamiento |
| MASCU | Numérica | Índice de Masculinidad (hombres cada 100 mujeres)|
| ESC | Numérica | Años de escolaridad promedio del jefe o jefa de hogar|


Iniciaremos nuestra investigación realizando un análisis previo mediante visualizaciones para observar posibles patrones, asociaciones y correlaciones a través de corrplots, variogramas, correlogramas y gráficas de dispersión, además de usar diversos test de asociación espacial. 

Posteriormente, construiremos modelos espacio temporales para datos de área (CARBayes), revisaremos a través de clusters algo JALDKJ y relizaremos predicciones espaciales (kriging)

Será necesario poner librerias???


# Análisis Previo

```{r echo = FALSE, warning= FALSE, message=FALSE, include=FALSE}
# Librerías ---------------------------------------------------------------

library(dplyr)
library(gstat)
library(sp)
library(ggplot2)
library(sf)
library(tmap)
library(readr) 
library(readxl)
library(spdep)
library(spatialreg)



# Bases -------------------------------------------------------------------

D2017 <- readxl::read_excel("Datos/Pob2017.xlsx")

# Cargo sf de las comunas
Chile <- sf::st_read("Datos/Comunas","comunas")

# Selecciono solo los de la RM
RM <- Chile %>% 
  dplyr::filter(Region == "Región Metropolitana de Santiago")

# Dejo con el mismo nombre la columna
RM <- RM %>% 
  rename(COMUNA = Comuna)

# Entrecruzo
D2017 <- RM %>% 
  left_join(D2017)

# Cantidad de habitantes por vivienda
D2017 <- D2017 %>% 
  mutate(Pob_Viv = POB/VIV)

# Base delitos

Del <- readxl::read_excel("Datos/Delitos_todos.xlsx")

# Arreglar el nombre de la comuna
Del$COMUNA[Del$COMUNA == "Caracaví"] <- "Curacaví"

D2017_Del <- D2017 %>% 
  mutate(COMUNA = tolower(D2017$COMUNA))

D2017_Del <- D2017 %>% 
  left_join(Del)

# Autocorrelación ---------------------------------------------------------

# Defino los vecinos
vecinos <- poly2nb(D2017)

# Hago las matrices de pesos
b_pesos <- nb2listw(vecinos, style ="B", zero.policy = TRUE)
w_pesos <- nb2listw(vecinos, style ="W", zero.policy = TRUE)

ver_b_pesos <- listw2mat(b_pesos)
ver_w_pesos <- listw2mat(w_pesos)
```

## Variable Hacinamiento

Tanto el test de Moran como el Geary nos dicen que existe autocorrelación espacial.

```{r warning= FALSE, message=FALSE, echo=FALSE}
moran.test(D2017$HACI, b_pesos, zero.policy = TRUE)
geary.test(D2017$HACI, b_pesos, zero.policy = TRUE)


mapview::mapview(D2017["HACI"],
                 layer.name = "% Hacinamiento",
                 legend = TRUE,
                 popup = paste0(
                   "<b>COMUNA: </b>"
                   , D2017$COMUNA
                   , "<br><b>% Hacinamiento: </b>"
                   , D2017$HACI
                 ))
```

## Variable Pob_Viv

Se generó una nueva variables ´Pob_Viv´ que resume la población y la cantidad de viviendas
de la comuna. Para esta variable tanto el test de Moran como el Geary nos dicen que existe autocorrelación espacial.

```{r warning= FALSE, message=FALSE, echo=FALSE}
### Indice Pob_Viv
moran.test(D2017$Pob_Viv, b_pesos, zero.policy = TRUE)
geary.test(D2017$Pob_Viv, b_pesos, zero.policy = TRUE)
mapview::mapview(D2017["Pob_Viv"],
                 layer.name = "Hab por Viv",
                 legend = TRUE,
                 popup = paste0(
                   "<b>COMUNA: </b>"
                   , D2017$COMUNA
                   , "<br><b>% Hab/Viv: </b>"
                   , D2017$Pob_Viv
                 ))
```

## Variable MASCU

Tanto el test de Moran como el Geary nos dicen que existe autocorrelación espacial.

```{r warning= FALSE, message=FALSE, echo=FALSE}
moran.test(D2017$MASCU, b_pesos, zero.policy = TRUE)
geary.test(D2017$MASCU, b_pesos, zero.policy = TRUE)
mapview::mapview(D2017["MASCU"],
                 layer.name = "Índice Masculinidad",
                 legend = TRUE,
                 popup = paste0(
                   "<b>COMUNA: </b>"
                   , D2017$COMUNA
                   , "<br><b>Índice Masculinidad: </b>"
                   , D2017$Pob_Viv
                 ))
```

## Variable ESC

Tanto el test de Moran como el Geary nos dicen que existe autocorrelación espacial.

```{r warning= FALSE, message=FALSE, echo=FALSE}
moran.test(D2017$ESC, b_pesos, zero.policy = TRUE)
geary.test(D2017$ESC, b_pesos, zero.policy = TRUE)
mapview::mapview(D2017["ESC"],
                 layer.name = "Escolaridad",
                 legend = TRUE,
                 popup = paste0(
                   "<b>COMUNA: </b>"
                   , D2017$COMUNA
                   , "<br><b>Escolaridad: </b>"
                   , D2017$Pob_Viv
                 ))

```

## En general

Todas las variables comunales de la base CENSO 2017 tienen autocorrelación espacial.

# Resultados 

# Conclusión

# Referencias



